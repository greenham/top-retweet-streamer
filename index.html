<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Twitter Top 10 ReTweet Live Streamer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/assets/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 20px;
        padding-bottom: 40px;
      }

      /* Custom container */
      .container-narrow {
        margin: 0 auto;
        max-width: 780px;
      }
      .container-narrow > hr {
        margin: 30px 0;
      }

      /* Main marketing message and sign up button */
      .jumbotron {
        margin: 60px 0;
        text-align: center;
      }
      .jumbotron h1 {
        font-size: 72px;
        line-height: 1;
      }
      .jumbotron .btn {
        font-size: 21px;
        padding: 14px 24px;
      }

      /* Supporting marketing content */
      .marketing {
        margin: 60px 0;
      }
      .marketing p + h4 {
        margin-top: 28px;
      }
    </style>
    <link href="/assets/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="/assets/js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="/assets/ico/apple-touch-icon-57-precomposed.png">
    <link rel="shortcut icon" href="/assets/ico/favicon.png">
  </head>

  <body>

    <div class="container-narrow">

      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li class="active"><a href="/">Home</a></li>
          <li><a href="#">About</a></li>
          <li><a href="mailto:chrisreidham@gmail.com">Contact</a></li>
        </ul>
        <h3 class="muted">Top 10 ReTweet Streamer</h3>
      </div>

      <hr>

      <div class="row-fluid hide" id="rt-container">
        <p class="pull-right"><a href="/" class="btn">Start a new search</a></p>
        <p>Tracking top 10 retweets for...</p>
        <h2></h2>
        <div id="rt-list"></div>
      </div>

      <div class="jumbotron">
        <form class="form-search" id="search-form">
          <p><input type="text" class="input-xlarge search-query" name="search-term"></p>
          <p><button type="submit" class="btn btn-large btn-success">Start Tracking</button></p>
          <p class="lead">Enter a search, twitter handle, or hashtag to start tracking the top retweets.</p>
        </form>
      </div>

      <hr>

      <div class="footer"></div>

    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/assets/js/jquery-1.10.2.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      $( document ).ready(function() {

        var socket  = io.connect('http://localhost'),
            rtDiv   = $('#rt-container');

        socket.on('data', function(tweets) {
          var theList = rtDiv.find('#rt-list');
          theList.fadeOut('fast', function() {
            theList.html('');
            $.each(tweets, function(index, tweet) {
              //theList.append($('<li>['+tweet.retweet_count+' RTs] @'+tweet.screen_name+': '+tweet.text+'</li>'));
              var newTweet = $('<div></div>');
              newTweet.html('<div class="media">\
                  <a class="pull-left" href="https://twitter.com/'+tweet.screen_name+'" target="_blank">\
                    <img class="media-object" alt="64x64" style="width: 64px; height: 64px;" src="http://placekitten.com/64/64">\
                  </a>\
                  <div class="media-body">\
                    <span class="pull-right badge badge-success">'+tweet.retweet_count+' RTs</span>\
                    <h4 class="media-heading"><a href="https://twitter.com/'+tweet.screen_name+'" target="_blank">\@'+tweet.screen_name+'</a></h4>\
                    '+tweet.text+'\
                  </div>\
                </div>');
              theList.append(newTweet);
            });
            theList.fadeIn();
          })
        });

        $('#search-form').on('submit', function(e) {
            e.preventDefault();
            var searchForm = $(this);
            var searchTerm = searchForm.find('input[name="search-term"]').val();
            socket.emit('filter', { query: searchTerm }, function() {
              searchForm.fadeOut('fast', function() {
                rtDiv.find('h2').html(searchTerm);
                rtDiv.fadeIn();
              });
            });
            return false;
        });
      });
    </script>
  </body>
</html>